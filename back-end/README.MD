## ν”„λ΅μ νΈ κµ¬μ΅° μ„¤λ… ([README.md](http://readme.md/))

### κ°μ”

λ³Έ λ¬Έμ„λ” `src/main/java/com/instagram/` λ””λ ‰ν† λ¦¬μ™€ `src/main/resources/mapper/` λ””λ ‰ν† λ¦¬μ **Instagram ν΄λ΅  ν”„λ΅μ νΈ** λ°±μ—”λ“ μ£Όμ” λ¨λ“ λ° νμΌ κµ¬μ΅°μ— λ€ν• μ„¤λ…μ„ λ‹΄κ³  μμµλ‹λ‹¤. ν”„λ΅μ νΈλ” Javaμ™€ Spring Boot κΈ°λ°μΌλ΅ κµ¬μ„±λμ—μΌλ©°, μ£Όμ” κΈ°λ¥λ³„λ΅ λ¨λ“ν™”ν•μ—¬ κ΄€λ¦¬ν•κ³  μμµλ‹λ‹¤.

### μ£Όμ” λ””λ ‰ν† λ¦¬ κµ¬μ΅°

```
src/main/java/com/instagram/
β”β”€β”€ user/          # μ‚¬μ©μ (νμ›κ°€μ…, λ΅κ·ΈμΈ, ν”„λ΅ν•„)
β”β”€β”€ post/          # κ²μ‹λ¬Ό
β”β”€β”€ comment/       # λ“κΈ€
β”β”€β”€ like/          # μΆ‹μ•„μ”
β”β”€β”€ story/         # μ¤ν† λ¦¬
β”β”€β”€ follow/        # ν”λ΅μ°
β””β”€β”€ common/        # κ³µν†µ μ„¤μ • λ° μ ν‹Έλ¦¬ν‹°

src/main/resources/mapper/
β”β”€β”€ UserMapper.xml
β”β”€β”€ PostMapper.xml
β”β”€β”€ CommentMapper.xml
β”β”€β”€ LikeMapper.xml
β”β”€β”€ StoryMapper.xml
β””β”€β”€ FollowMapper.xml
```

---

### λ¨λ“λ³„ μƒμ„Έ μ„¤λ…

### 1. `user/` (μ‚¬μ©μ)

μ‚¬μ©μ(User)μ **νμ›κ°€μ…, λ΅κ·ΈμΈ, ν”„λ΅ν•„ κ΄€λ¦¬**μ™€ κ΄€λ ¨λ λ΅μ§μ„ λ‹΄λ‹Ήν•©λ‹λ‹¤.

| νμΌ/λ””λ ‰ν† λ¦¬ | μ—­ν•  |
| --- | --- |
| `User.java` | μ‚¬μ©μ **Entity/Domain** ν΄λμ¤ |
| `UserMapper.java` | μ‚¬μ©μ κ΄€λ ¨ **MyBatis Mapper** μΈν„°νμ΄μ¤ |
| `UserService.java` | μ‚¬μ©μ κ΄€λ ¨ **Service** μΈν„°νμ΄μ¤ |
| `UserServiceImpl.java` | `UserService`μ **κµ¬ν„μ²΄** (λΉ„μ¦λ‹μ¤ λ΅μ§) |
| `UserController.java` | μ‚¬μ©μ κ΄€λ ¨ **Controller** (API μ—”λ“ν¬μΈνΈ) |


### 2. `post/` (κ²μ‹λ¬Ό)

**κ²μ‹λ¬Ό(Post) μƒμ„±, μ΅°ν, μμ •, μ‚­μ **μ™€ κ΄€λ ¨λ λ΅μ§μ„ λ‹΄λ‹Ήν•©λ‹λ‹¤.

| νμΌ/λ””λ ‰ν† λ¦¬ | μ—­ν•  |
| --- | --- |
| `Post.java` | κ²μ‹λ¬Ό **Entity/Domain** ν΄λμ¤ |
| `PostMapper.java` | κ²μ‹λ¬Ό κ΄€λ ¨ **MyBatis Mapper** μΈν„°νμ΄μ¤ |
| `PostService.java` | κ²μ‹λ¬Ό κ΄€λ ¨ **Service** μΈν„°νμ΄μ¤ |
| `PostServiceImpl.java` | `PostService`μ **κµ¬ν„μ²΄** (λΉ„μ¦λ‹μ¤ λ΅μ§) |
| `PostController.java` | κ²μ‹λ¬Ό κ΄€λ ¨ **Controller** (API μ—”λ“ν¬μΈνΈ) |

### 3. `comment/` (λ“κΈ€)

κ²μ‹λ¬Όμ— λ€ν• **λ“κΈ€(Comment) κ΄€λ ¨** λ΅μ§μ„ λ‹΄λ‹Ήν•©λ‹λ‹¤.

| νμΌ/λ””λ ‰ν† λ¦¬ | μ—­ν•  |
| --- | --- |
| `Comment.java` | λ“κΈ€ **Entity/Domain** ν΄λμ¤ |
| `CommentMapper.java` | λ“κΈ€ κ΄€λ ¨ **MyBatis Mapper** μΈν„°νμ΄μ¤ |
| `CommentService.java` | λ“κΈ€ κ΄€λ ¨ **Service** μΈν„°νμ΄μ¤ |
| `CommentServiceImpl.java` | `CommentService`μ **κµ¬ν„μ²΄** (λΉ„μ¦λ‹μ¤ λ΅μ§) |
| `CommentController.java` | λ“κΈ€ κ΄€λ ¨ **Controller** (API μ—”λ“ν¬μΈνΈ) |

### 4. `like/` (μΆ‹μ•„μ”)

κ²μ‹λ¬Όμ΄λ‚ λ“κΈ€μ— λ€ν• **μΆ‹μ•„μ”(Like)** κ΄€λ ¨ λ΅μ§μ„ λ‹΄λ‹Ήν•©λ‹λ‹¤.

| νμΌ/λ””λ ‰ν† λ¦¬ | μ—­ν•  |
| --- | --- |
| `Like.java` | μΆ‹μ•„μ” **Entity/Domain** ν΄λμ¤ |
| `LikeMapper.java` | μΆ‹μ•„μ” κ΄€λ ¨ **MyBatis Mapper** μΈν„°νμ΄μ¤ |
| `LikeService.java` | μΆ‹μ•„μ” κ΄€λ ¨ **Service** μΈν„°νμ΄μ¤ |
| `LikeServiceImpl.java` | `LikeService`μ **κµ¬ν„μ²΄** (λΉ„μ¦λ‹μ¤ λ΅μ§) |
| `LikeController.java` | μΆ‹μ•„μ” κ΄€λ ¨ **Controller** (API μ—”λ“ν¬μΈνΈ) |

### 5. `story/` (μ¤ν† λ¦¬)

**μ¤ν† λ¦¬(Story)** κΈ°λ¥ κ΄€λ ¨ λ΅μ§μ„ λ‹΄λ‹Ήν•©λ‹λ‹¤.

| νμΌ/λ””λ ‰ν† λ¦¬ | μ—­ν•  |
| --- | --- |
| `Story.java` | μ¤ν† λ¦¬ **Entity/Domain** ν΄λμ¤ |
| `StoryMapper.java` | μ¤ν† λ¦¬ κ΄€λ ¨ **MyBatis Mapper** μΈν„°νμ΄μ¤ |
| `StoryService.java` | μ¤ν† λ¦¬ κ΄€λ ¨ **Service** μΈν„°νμ΄μ¤ |
| `StoryServiceImpl.java` | `StoryService`μ **κµ¬ν„μ²΄** (λΉ„μ¦λ‹μ¤ λ΅μ§) |
| `StoryController.java` | μ¤ν† λ¦¬ κ΄€λ ¨ **Controller** (API μ—”λ“ν¬μΈνΈ) |

### 6. `follow/` (ν”λ΅μ°)

**μ‚¬μ©μ κ°„μ ν”λ΅μ°(Follow)** κ΄€κ³„ κ΄€λ¦¬ λ΅μ§μ„ λ‹΄λ‹Ήν•©λ‹λ‹¤.

| νμΌ/λ””λ ‰ν† λ¦¬ | μ—­ν•  |
| --- | --- |
| `Follow.java` | ν”λ΅μ° **Entity/Domain** ν΄λμ¤ |
| `FollowMapper.java` | ν”λ΅μ° κ΄€λ ¨ **MyBatis Mapper** μΈν„°νμ΄μ¤ |
| `FollowService.java` | ν”λ΅μ° κ΄€λ ¨ **Service** μΈν„°νμ΄μ¤ |
| `FollowServiceImpl.java` | `FollowService`μ **κµ¬ν„μ²΄** (λΉ„μ¦λ‹μ¤ λ΅μ§) |
| `FollowController.java` | ν”λ΅μ° κ΄€λ ¨ **Controller** (API μ—”λ“ν¬μΈνΈ) |

### 7. `common/` (κ³µν†µ)

**μ „μ—­ μ„¤μ •, κ³µν†µ μ ν‹Έλ¦¬ν‹°, API μ‘λ‹µ ν•μ‹** λ“± κ³µν†µ μ”μ†λ¥Ό λ‹΄λ‹Ήν•©λ‹λ‹¤.

| νμΌ/λ””λ ‰ν† λ¦¬ | μ—­ν•  |
| --- | --- |
| `config/WebConfig.java` | Spring MVC **μ›Ή μ„¤μ •** (CORS λ“±) |
| `config/SecurityConfig.java` | Spring Security **λ³΄μ• μ„¤μ •** (μΈμ¦, κ¶ν•) |
| `dto/ApiResponse.java` | λ¨λ“  API μ‘λ‹µμ **ν‘μ¤€ ν•μ‹** DTO |

---

### MyBatis λ§¤νΌ νμΌ

`src/main/resources/mappers/` λ””λ ‰ν† λ¦¬μ—λ” κ° λ¨λ“λ³„ **SQL λ§¤ν•‘ μ •λ³΄**λ¥Ό λ‹΄κ³  μλ” XML νμΌλ“¤μ΄ μ„μΉν•©λ‹λ‹¤.

| νμΌ | μ—­ν•  |
| --- | --- |
| `UserMapper.xml` | μ‚¬μ©μ(User) κ΄€λ ¨ **SQL μ •μ** |
| `PostMapper.xml` | κ²μ‹λ¬Ό(Post) κ΄€λ ¨ **SQL μ •μ** |
| `CommentMapper.xml` | λ“κΈ€(Comment) κ΄€λ ¨ **SQL μ •μ** |
| `LikeMapper.xml` | μΆ‹μ•„μ”(Like) κ΄€λ ¨ **SQL μ •μ** |
| `StoryMapper.xml` | μ¤ν† λ¦¬(Story) κ΄€λ ¨ **SQL μ •μ** |
| `FollowMapper.xml` | ν”λ΅μ°(Follow) κ΄€λ ¨ **SQL μ •μ** |

---
# νΈλ¬λΈ” μν…

# π“ Story ID μ§μ ‘ μ‚½μ…μΌλ΅ μΈν• INSERT μ¤λ¥

## λ¬Έμ μ 

MyBatisμ—μ„ stories ν…μ΄λΈ”μ— λ°μ΄ν„° INSERTμ‹ useGeneratedKeysλ΅ PKκ°€ μ •μƒμ μΌλ΅ λ§¤ν•‘λμ§€ μ•λ” λ¬Έμ κ°€ λ°μƒν–μµλ‹λ‹¤.
````
Duplicate entry '0' for key 'PRIMARY'
````

## μ›μΈ
INSERT κµ¬λ¬Έμ—μ„ μλ™ μ¦κ°€(primary key)λ΅ κ΄€λ¦¬λλ” story_idλ¥Ό μ§μ ‘ λ„£κ³  μμ—μµλ‹λ‹¤.

```xml
<insert id="insertStory" parameterType="Story" useGeneratedKeys="true" keyProperty="storyId" keyColumn="story_id">
    INSERT INTO stories(story_id, user_id, story_image, created_at, expires_at)
    VALUES (#{storyId}, #{userId}, #{storyImage}, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP + INTERVAL '24 hours');
</insert>
```
## λ¬Έμ  λ°μƒ μ΄μ 
story_idλ” AUTO_INCREMENT / SERIAL / IDENTITYλ΅ μλ™ μƒμ„±ν•΄μ•Ό ν•©λ‹λ‹¤.
ν•μ§€λ§ κ°λ°μκ°€ μ§μ ‘ κ°’μ„ λ„£μ„ κ²½μ° INTκ°’μ΄λ―€λ΅ 0μ΄ λ“¤μ–΄κ°€κ³  μ΄λ―Έ μ΅΄μ¬ν•λ” IDλ¥Ό λ„£μΌλ©΄ PRIMARY KEY μ¶©λ ν•μ—¬ MyBatisμ useGeneratedKeysκ°€ μ‘λ™ν•μ§€ μ•μ
μ¦‰, PKλ¥Ό μλ™ μ…λ ¥ν•΄ μλ™ μ¦κ°€ λ΅μ§μ΄ κΉ¨μ§€λ” λ¬Έμ κ°€ λ°μƒν–μµλ‹λ‹¤.

## λ³€κ²½ ν›„ μ½”λ“
```xml
<insert id="insertStory" parameterType="Story" useGeneratedKeys="true" keyProperty="storyId" keyColumn="story_id">
    INSERT INTO stories(user_id, story_image, created_at, expires_at)
    VALUES (#{userId}, #{storyImage}, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP + INTERVAL '24 hours')
</insert>
```

## κ²°κ³Ό
* Story μ—…λ΅λ“ μ •μƒ λ™μ‘
* μλ™ PK μƒμ„± κΈ°λ¥ μ •μƒν™”
* MyBatisμ—μ„ storyId κ°’ μλ™ μμ‹  μ„±κ³µ

## μ”μ•½
μλ™ μ¦κ°€λμ–΄μ•Ό ν•λ” story_idλ¥Ό INSERT μ‹ μ§μ ‘ μ „λ‹¬ν• κ²ƒμ΄ λ¬Έμ μ μ›μΈμ΄μ—μµλ‹λ‹¤.
ν•΄λ‹Ή ν•„λ“λ¥Ό μ κ±°ν•΄ DB μλ™ μƒμ„± λ°©μ‹μΌλ΅ λλλ¦ΌμΌλ΅μ¨ PK μ¶©λ λ¬Έμ  ν•΄κ²° + useGeneratedKeys μ •μƒ λ™μ‘μ΄ μ΄λ£¨μ–΄μ΅μµλ‹λ‹¤.
